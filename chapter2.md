## 文件管理与常用命令

### 文件及其文件管理
---
#### 文件类型
> 所有的都是文件，文件后缀没有意义
```
类型 | 简称 | 描述
普通文件  -  可以根据权限对普通文件查看、更改、删除，包括纯文本、二进制、数据格式、压缩文件等，第一个属性为-
目录文件  d  目录文件包括各自目录下的文件名和指向文件名的指针，只要有权限就能访问目录下所有文件，打开目录文件就是打开目录（cd命令），第一个属性为d
硬链接    -  硬链接就是同一文件使用了多个别名删除时，只会删除链接，不会删除文件。局限为不能引用其他分区的文件，不能引用目录。
符号链接  l  又名软链接。存放的内容是另一文件的路径名，类似快捷方式。
字符设备文件  c  一般隐藏在/dev目录下，用作设备读取和外设交互，第一个属性为c
块设备文件    b  存储数据供系统存取的接口设备，硬盘光驱等。设备文件只有字符设备和块设备，第一个属性为b
fifo管道文件  p  用于进程间通讯，解决多个程序同时存取一个文件造成的错误，启动进程A从fifi读数据，启动进程B从fifo写数据，先进先出，随写随读。
套接字        s  监听客户端时，客户端通过套接字进行数据通信，一般隐藏在/var/run下，第一个属性为s
```

#### 文件命名规则
> 1-256字符，字母数字点下划线连字符
```
尽量不要使用？?、*、$、&、！、|、\、[]、{}、()、/等，'.'开头为隐藏文件。
文件名区分大小写
```

#### 目录操作命令
> pwd
```
功能: 显示当前目录绝对路径
格式: pwd
```

> cd
```
功能: 改变当前所在目录
格式: cd 目录名
```

> mkdir
```
功能: 创建目录
格式: mkdir [选项] 目录名
常用选项:
-m 数字: 设置存取权限
-p: 若父目录不存在，则同时创建父目录与该目录
```

> rmdir
```
功能: 删除目录（必须为空目录）
格式: rmdir [选项] 目录名
常用选项:
-p 删除目录时一同删除父目录，前提是父目录中无其他目录及文件
```
> ls
```
功能: 显示文件和目录列表
格式: ls [选项] [目录名或文件名]
常用选项:
-a 列出包含隐藏文件('.')的所有文件
-b 文件名中不可输出的字符用反斜杠加字符编号来输出
-d 将目录像文件一样显示，不显示其包含的文件
-e 输出时间的全部信息，而不是简略信息
-k 以k字节的形式显示文件大小
-l 列出文件详细信息
-m 横向输出文件名,end=','
-n 以UID、GID代替名称
-p/-F 每个文件后附上字符说明类型，'*'可执行普通文件，'/'目录，'@'符号链接，'|'FIFOS，'='套接字
-r 对目录反向排序
-s 文件名后输出文件大小
-t 按文件最后修改时间排序
-u 按上次文件被访问的时间排序
-x 按列输出，横向排序
-l 一行只输出一个文件
--color=no 不显示彩色文件名
```
#### 文件操作命令
> cat
```
功能: 显示一个或多个文件的内容
格式: cat [选项] 文件名
常用选项:
-n 对输出行数编号
-b 对输出行数编号，但不对空白行编号
-s 遇到连续两行以上空白行，代换为一行空白行
e.g. cat file2 file1>file3 //把file2 file1文件内容按顺序合并为file3（如file3已存在，则覆盖掉）
e.g. cat >filename <<EOF
```
> head
```
功能: 显示文件开头，默认前十行
格式: head [选项] 文件名
常用选项:
-n num 显示文件的前num行
-c num 显示文件的前num个字符
```
> tail
```
功能: 显示文件末尾，默认后十行
格式: tail [选项] 文件名
常用选项:
-n num 显示文件后num行
-c num 显示文件后num个字符
```
> more
```
功能: 分屏显示文件内容
格式: more [选项] 文件名
常用选项:
-d 提示使用者
-f 计算实际行数
-p 不卷动，显示新内容时清除屏幕
-c 同上，但先显示内容再清除
-s 遇到连续两行以上空白行，代换为一行空白行
-u 不显示下引号
+/ 从该字串开始显示
-num 指定屏幕上一次显示的行数
+num 从第num行开始显示
常用指令:
空格  向下翻页
Enter 向下一行
q     终止浏览文件
```
> less
```
功能: 分屏显示文件内容
格式: less [option] filename
常用选项:
-a 在当前屏幕显示最后一页
-c 从顶部（从上到下）刷新屏幕，并显示文件内容，而不是通过底部滚动完成刷新
-f 强制打开文件，二进制文件显示时，不提示警告
-s 遇到连续两行以上空白行，代换为一行空白行
常用指令:
空格 翻页
pagedown/pageup 翻行
/               向下搜寻字符串
g/G             到文件第一行/最后一行
q               离开
```
> touch
```
功能: 生成新文件、更改现有文件时间标签
格式: touch [option] filename
常用选项:
-a 改变文件的读取时间标签
-c 假如目的文件不存在，不会建立新的文件
-m 改变文件的修改时间标签
-d 设定时间与日期，可以使用各种不同的格式，如-d yyyymmdd
-r 指定使用文件属性而非目前的时间
--nocreate 不会建立新文件
--version 列出版本信息
```
> sort
```
功能: 对文本文件每行进行排序
格式: sort [option] 文件列表
常用选项:
-b 忽略每行前面开始出的空格字符
-c 检查文件是否已经按照顺序排序
-d 排序时，处理英文字母、数字及空格字符外，忽略其他的字符
-f 排序时，将小写字母视为大写字母
-i 排序时，只排序可打印字符，忽略其他的字符
-m 将几个排序好的文件进行合并
-M 将前面3个字母依照月份的缩写进行排序
-n 依照数值的大小排序
-o<输出文件> 将排序后的结果存入指定的文件
-r 以相反的顺序来排序
-t<分隔字符> 指定排序时所用的栏位分隔字符
+<起始栏位> -<结束栏位> 以指定的栏位来排序，范围由起始栏位到结束栏位的前一栏位
```
> diff
```
功能: 比较文件的不同
格式: diff [option] 源文件 目标文件
常用选项:
-a 将文件按照文本文件处理
-b 忽略空格
-B 忽略空行
-q 只报告哪里不同，不报告不同信息
-i 忽略大小写
```
> cp
```
功能: 复制文件或目录
格式: cp [option] 源文件/目录 目标文件/目录
常用选项:
-a 尽可能文件状态、权限等原状复制
-f 若目标存在，先删除再复制
-i 若目标存在，提示是否覆盖
-r 递归复制目录，包含各级子目录
```
> rm
```
功能: 删除文件或目录
格式: rm [option] 文件列表
常用选项:
-i 删除文件或目录时提示
-f 删除文件或目录时不提示
-R 递归删除目录，包含文件和各级子目录
```
> mv
```
功能: 移动文件或目录、重命名文件或目录
格式: mv [option] 源文件/目录 目标文件/目录
常用选项:
-i 若目标存在，则提示是否覆盖
-f 无论目标是否存在，都直接覆盖
```
> wc
```
功能: 统计文件的字节数、字数、行数
格式: wc [option] filename
常用选项:
-c 统计字节数
-l 统计行数
-m 统计字符数
-w 统计字数
```
### Linux 文件权限
---
#### 用户与用户组
> 权限基于三类用户设定
* 文件拥有者（user）
* 组用户（group）
* 其他（others）

```root用户不受权限控制```
#### 文件权限概述
> 根据赋予权限的不同，3种不同用户能访问不同目录或文件
* 所有者是创建文件的目录，能授予所在用户组及组外其他用户文件访问权限
* 每一个用户都有自己的读写和执行的权限
#### 文件属性概览
> **-rwxr-xr-x 2 root root 4096 June 3 23:59 brave.sh**
* 文件类型权限
```
第一个字符是文件类型，d、-、l等
2-10个字符为访问权限，每三个一组，
第一组为**所有者权限** (u)
第二组为**同组其他用户的权限** (g)
第三组为**其他用户的权限** (o)
r读取，w写入，x执行，-无此权限
```
* 表示有多少文件名连结到此节点（i-node）
```
每个文件都会将其权限和属性记录到文件系统的i-node中，
但目录树用文件记录，因此文件名会连接i-node
此处就是有多少不同文件名连接到了相同的i-node
```
* 拥有者账号
* 文件所属群组
```
账号会附属于一个或多个群组，权限问题
```
* 容量大小，默认bytes
* 创建日期或最近修改日期
```
一般为月日时间，但如果时间太久，只显示年份
完整时间格式 ls -l --full-time
```
* 文件名
#### 权限概述
> 文件权限
* r(read)    可读取文件实际内容
* w(write)   可编辑、新增或修改文件内容（但不含删除文件）
* x(execute) 可以被系统执行
> 目录权限
* r(read)    可查看目录结构，查询目录下文件名
* w(write)   建立新文件和目录，传出已存在文件或目录，更名文件目录，搬移该目录内文件、目录位置
* x(execute) 能否进入该目录工作
```
权限不足，用root(sudo)，或修改文件权限
```
#### 权限修改
> **chmod [option] filename**
* 数字表示法
```
rwx分别为421
rw-rw-r--:664
因此命令为: chmod 664 filename
```
* 文字表示法
```
用户表示: u g o a(all)
权限表示: r w x
操作符号: + - =
e.g. chmod u=rwx,g=r,o=x filename
```
#### 文件所有者与属组修改
> chmod 选项 要修改成的所有者和属组 文件

```仅root用户```
* 所有者和属组都改为test
```
chmod test:test filename
```
* 仅修改所有者
```
chmod test filename
```
* 仅修改属组
```
chmod :test filename
or
chgrp test filename
```
#### 文件默认权限
> 
#### 特殊权限
### 文件的搜索
---
#### 文件通配符
> 星号 *
```
匹配任意长度的文件名字符串
```
> 问号 ?
```
匹配任一单字符
```
> 点字符 .
```
作为文件名和路径名分量的第一个字符，必须显式匹配
```
> 方括号 []
```
匹配括号内任一字符，也可以用减号规定范围
e.g. [A-Z]* [Mn]*
```
> [^]
```
若括号内第一个字符为^，则反向选择
e.g. [^abc]指除了abc任一字符
```
#### 文件查找命令
> find
* 功能: 查找满足条件的文件
* 格式: find 路径 选项 [-print -exec -ok]
* 常用选项:
```
-name filename 查找指定名称
-user username 属于指定用户的文件
-group grpname 查找属于指定组的文件
-size n        查找比n大或小的文件,+n大于，-n小于，nc查找为n byte的文件，nk表示n*1024bytes
-inum n        查找索引节点号为n的文件
-type          查找指定类型的文件（b、c、d、p、l、f）
-atime n       查找n天前被访问的文件。 +n: n天前 -n: n天内 n: n天前（仅那一天）
-mtime n       同上，但查找的是文件被修改的时间
-ctime n       同上，但查找的是文件索引节点被改变的时间
-perm mode     查找与给定权限匹配的文件，八进制给出访问权限。mode表示权限为mode，-mode搜索权限包括mode的文件（范围比mode大），/mode表示搜索符合任何一个权限的文件（范围比mode小）
-newer file    查找比指定文件修改时间更新的文件
-exec command {} \ 对匹配指定条件的文件执行command命令
-ok command {} \; 同上，但执行command时需用户确认
-print         显示查找结果
```
使用示例:
```
find . -type d
find . -name 'fuck*' -type d
find . -newer fkgfw.txt
find / -perm 4755      //查找有4权限的
find ~ -name "*.txt" -ok rm {} \       //找出用户主目录下所有的.txt文件并删除
```
> locate
* 功能: 查找文件，支持通配符
* 格式: locate [选项] [文件名]
``` locate fkgfw*     //查找fkgfw开头的文件 ```
> whereis
* 功能: 寻找命令的可执行文件所在位置
* 格式: whereis [选项] [文件名]
* 常用选项:
```
-b 只查找二进制文件
-m 只查找命令的联机帮助手册部分
-s 只查找源代码文件
```
> grep
* 功能: 查找文件中包含有指定字符串的行
* 格式: grep [选项] 查找模式 [file1,file2,...]
        grep [选项] [-e 查找模式| -f 文件] [file1,file2,...]
* 常用选项:
```
-v 列出不匹配的行
-c 对匹配的行计数
-l 只显示包含匹配模式的文件名
-n 每个匹配行只按照相对的行号显示
-i 对匹配模式不区分大小写
-s 不显示不存在或无匹配文本的错误信息
-h 查询多文件时不显示文件名
```
### 文件的归档与压缩处理
---
#### 文件压缩
> gzip
* 功能: 文件压缩
* 方法: gzip [选项] 待压缩文件名，生成.gz文件
* 常用选项:
```
-c 将压缩的数据输出到屏幕上
-d 解压缩
-t 检验压缩文件的完整性
-v 显示出源文件/压缩文件的压缩比等信息
-num 数字代表压缩等级-1最快，但压缩比最差，预设为-6
```
> bzip2
* 功能: 文件压缩
* 方法: bzip2 [选项] 待压缩文件名，生成的.bz2文件
* 常用选项:
```
-d 解压缩
-v 显示出源文件/压缩文件的压缩比等信息
-k: 在压缩或解压缩时保留输入文件（不删除这些文件）
-num 数字代表压缩等级-1最快，但压缩比最差，预设为-6
```
> xz
* 功能: 文件压缩
* 选项： xz [选项] 待压缩文件名，生成.xz文件
* 常用选项:
```
-d 解压缩
-v 显示出源文件/压缩文件的压缩比等信息
-k: 在压缩或解压缩时保留输入文件（不删除这些文件）
-num 数字代表压缩等级-1最快，但压缩比最差，预设为-6
-f：解压强制覆盖文件
-l: 列出压缩文件中的相关信息
-t: 测试压缩文件的完整性
```
> 查看纯文本文件压缩内容
* gzip  zcat/zmore/zless
* bzip2 bzcat bzmore bzless
* xz    xzcat xzmore xzless
#### 文件归档
> tar
* 功能：多个文件打包在一个文件里
* 格式：tar [选项] 包名 待归档文件或目标列表
* 常用选项：
```
-c 创建新文件
-f 制定备份文件名
-t 列出备份文件内容，查看已备份文件
-x 从备份文件中还原文件
-v 显示指令执行过程
-r 添加文件到归档包文件底部
-C 解压到指定的目录
-z 用gzip来压缩/解压缩文件，加上该选项后可以将文件进行压缩，但还原时也要用该选项进行解压缩
```
> 文件归档与压缩通常一同进行
* tar -z: gzip解压或压缩，生成*.tar.gz
* tar -j: bzip2解压或压缩，生成*.tar.bz
* tar -J: xz解压或压缩，生成*.tar.xz
> 使用举例
* tar –cf example.tar *  ```对当前目录下的所有文件进行打包，生成example.tar
* tar -cvf example.tar * ```打包同时，列出包里的文件
* tar -tf example.tar *  ```查看包example.tar内容
### 目录配置
---
#### 目录树
> 按照文件系统层次化标准采用树形结构（目录树）
```
不存在cdef等盘符，树形结构定义了常见目录的用途
```
> 特点
* 起点始终为根目录/
* 目录不仅能使用本地的文件系统，还能使用网络上的文件系统
* 每一个文件在此目录树中的文件名独一无二
#### 文件系统与目录树的关系
> 硬盘需经过分区、格式化、挂载才能使用
* 分区   将整体存储空间划分为多个独立区域，用作安装操作系统等不同功能
* 格式化 磁盘分区后需格式化，每种操作系统设定的文件属性、权限并不相同
* 挂载   利用一个目录当进入点，把磁盘分区槽的数据放置在该目录下，进入该目录就能读取该分区槽
> 每一个文件都会占用一个inode
* 对目录，inode会存储属性、权限以及分配的data block号 ```data block存储的是文件名与该文件对应的inode号
* 对普通文件 inode会存储属性、权限以及分配的data block号
> 目录树读取方式 从根目录的inode逐层向下访问
* 例如访问/etc/passwd
```
通过挂载点信息找到根目录的inode，查看inode中的权限是否可读取data block
从data block中找到etc目录的inode，查看权限，读取etc的data block
从etc的data block中找到passwd的inode，查看权限，读取passwd内容
```
#### 文件和目录的布局
> FHS
```
由于发行版很多，因此目的是规范特定目录下应放置什么内容
实际定义了'/','/var','/usr'三个目录下的具体内容
```
> 具体布局
* /bin 
```
/bin放置的是在单人维护模式下还能操作的指令
其指令可以被root与一般账号使用，如cat,chmod,chown,date,mv,mkdir,cp,bash等
```
* /sbin
```
开机需要的命令
```
* /boot
```
主要放置开机会使用的文件
包括linux核心文件以及开机选单与开机所需设定档等
linux kernel常用文件名vmlinuz，如果使用grub2开机管理模式，则存在/boot/grub2/
```
* /dev
```
任何装备与设备都是以文件的形态存在于此目录
存取该目录下某个文件就相当于存取某设备
如/dev/null,/dev/zero,/dev/tty,/dev/loop*,/dev/sd*等
```
* /etc
```
系统主要的配置文件都放置在此处，包括账号密码、服务的配置文件等
该目录下的文件可以让一般使用者读，但只有root可修改
FHS建议不要在该目录下放置可执行文件
```
* /lib
```
放置在开机时会用到的函数库，以及在/bin或/sbin下指令需调用的函数库
```
* /home
```
用户家目录
```
* /media
```
放置可移除设备，软盘光盘等设备都暂时挂载在此处
常见档名/media/cdrom,/media/floppy
```
* /mnt
```
可放置暂时挂载的额外装置
```
* /opt
```
放置第三方的软件
```
* /root
```
root用户家目录
```
* /srv
```
网络服务的数据文件目录
```
* /tmp
```
任何人都可使用的‘共享’临时目录
```
* /proc
```
虚拟文件系统，如系统内核、进程、外部设备及网络状态等
```
* /run
```
早期的 FHS 规定系统开机后所产生的各项信息应该要放置到 /var/run目录下，新版的 FHS 则规范到 /run 底下
```
* /usr 第二层 FHS 设定，主要为放置不变动的内容
```
/usr/bin:   所有一般用户能够使用的指令都在改目录里，Cenos7已将全部的用户命令放置在该目录，/bin链接到此目录。FHS要求该目录下不应该有子目录
/usr/lib:   与lib功能大致形同，/lib链接到此目录
/usr/local: 系统管理员在本机自行下载安装的软件，建议安装到此目录
/usr/sbin:  基本功能与/sbin相同，/sbin连接到此目录中
/usr/share: 放置共享数据文件，比如联机帮助文件、软件的说明等
```
* /var 第二层 FHS 设定，主要为放置变动性的内容
```
/var/cache: 程序运行中产生的缓存文件
/var/lib:   程序运行过程中需要的数据文件，比如mysql、rpm的数据库
/var/lock:  防止同时使用一个设备或文件，将该设备或文件上锁，解锁后才能由后续使用者使用，现在已放到/run/lock中
/var/log:   非常重要，包括系统运行的日志文件，比如message、dmessages等
/var/run:   存放程序运行的pid，连接到run目录。
```
#### 绝对目录和相对路径
* 绝对路径 根目录写起，如/home/sadasd
* 相对路径 相对于目前路径的写法，如../dir1/dir2
```.当前目录 ..上一层目录 -上一个工作目录 ~当前用户家目录```
### 硬链接和符号链接
---
为避免同样文件在系统中不必要复制，可创建文件链接，可在不同位置存取同一文件，实现文件共享
```快捷方式（bushi）```
#### 硬链接和符号链接
> 硬链接
* 含义 一个文件的一个或多个文件名，把文件名和文件系统使用的节点号链接起来
* 格式 ln 源文件 创建的目标链接文件
* 限制 不能对目录文件做硬链接，不能在不同文件系统之间做硬链接
* 特点
```
创建的硬链接文件和源文件 节点号相同
创建的硬链接文件和源文件 命名可以不同
创建的硬链接文件和源文件 属性相同
源文件删除了，而链接文件仍具有原来特性
更改源文件或链接文件属性，则全部更改
```
> 符号链接（软链接）
* 将一个路径名链接到一个文件上，类似快捷方式
* 格式 ln -s 源文件 创建的目标链接文件
* 特点
```
软链接是一个新文件，它与目标文件有不同的inode
软链接可以对目录文件做符号链接，也可以在不同文件系统之间做符号链接
删除源文件或目录时，不会删除链接，但链接失效
软链接的大小是其链接文件的路径名中的字节数
在目录长列表中，符号链接作为一种特殊的文件类型显示出来，其第一个字母是l
```
#### 目录的连接数
> 目录的link数=直属子目录数+2；新建目录为2， 上层+1
### 系统调用
---
